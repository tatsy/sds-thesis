\documentclass[12pt,a4paper,twoside,openany]{book}
\usepackage{pethesis}

% 図が多くビルドに時間がかかるときは
% \documentclass[12pt,a4paper,twoside,openany,draft]{book}
% のように\documentarticleのオプションに「draft」を追加する

% ***** フォントについて *****
% フォントに関してはIPAexフォントとGoogle Notoフォントを
% オプションとして用意していますので、好みの方をお使いください (初期値はIPAフォント)。
% なお斜体のフォントはIPAフォントのみ対応
% \usepackage[jpfont=ipa]{pethesis}
% https://ja.osdn.net/projects/luatex-ja/wiki/LuaTeX-ja%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9

% ***** 節の自動改行 *****
% 各節を自動で改ページする場合はautobreaksecオプションを追加
% \usepackage[autobreaksec]{pethesis}

% ***** 追加のパッケージ *****
% ！注意！
% グラフィクス用のpackageは既にusepackageしているので、
% \usepackage[dvips]{graphics}などと書くとエラーになる
% (\usepackage[xetex]{graphicx}を使わないといけない)
\usepackage{amsmath,amssymb}
\usepackage{mathtools}
\usepackage{url}
\usepackage{array}
\usepackage{booktabs}
\usepackage{here}
\usepackage{algorithm,algpseudocode}
\usepackage{tabularray}
\UseTblrLibrary{booktabs}

% ***** BibTeXの設定 *****
\usepackage[
  backend=biber,
  backref=true,
  sortcites=true,
  style=ieee,
  citestyle=numeric,
  maxbibnames=999,
  mincitenames=999,
  maxcitenames=999,
  sorting=none,
  url=false,
  doi=true,
  isbn=true
]{biblatex}

% backrefの表記を編集
\DefineBibliographyStrings{english}{%
  backrefpage = {cited on page},    % originally "cited on page"
  backrefpages = {cited on pages},  % originally "cited on pages"
}

% 余計な項目を非表示にしておく (必要な場合はコメントアウトする)
\AtEveryBibitem{
  \clearfield{eprint}%
  \clearfield{date}%
  \clearfield{month}%
  \clearfield{issn}%
  \clearfield{series}%
  \clearlist{address}%

  % "book"以外から削除する項目
  \ifentrytype{book}{}{
    \clearfield{isbn}%
    \clearname{editor}%
    \clearlist{publisher}%
  }
}

% BibTeXのソースを指定
\addbibresource{pethesis.bib}

% ***** リンクの設定 *****
% たまにコンパイルに失敗する可能性あり
% 必ず最後にusepackageすること
\ifxetex
  \usepackage[xetex]{hyperref}
\else
  \ifluatex
    \usepackage[luatex]{hyperref}
  \else
    \usepackage{hyperref}
  \fi
\fi

\hypersetup{
  backref=true,
  bookmarks=true,
  colorlinks=true,
  linktocpage=true,         % 目次においてページ番号にリンクをつける
  linkcolor=[rgb]{0, 0, 1}, % 主に章や節の番号のリンク
  citecolor=[rgb]{0, 0, 1}, % 文献の引用
  urlcolor=[rgb]{0, 0, 1}   % URL
}

% なおリンクを残しつつ、リンクの文字が目立たないようにしたい場合には
% 以下のコマンドに置き換える。
% \hypersetup{hidelinks}

% ***** CleverRefの設定 *****
\usepackage{cleveref}

\newcommand{\crefformatJP}[3]{%
  \crefformat{#1}{#2\,##2##1##3\,#3}%
  \crefrangeformat{#1}{#2\,##3##1##4\,#3から#2\,##5##2##6\,#3}%
  \crefmultiformat{#1}{#2\,##2##1##3\,#3}{ならびに#2\,##2##1##3\,#3}{、#2\,##2##1##3\,#3}{ならびに#2\,##2##1##3\,#3}%
}
\crefformatJP{equation}{式}{}
\crefformatJP{figure}{図}{}
\crefformatJP{table}{表}{}
\crefformatJP{algorithm}{アルゴリズム}{}
\crefformatJP{chapter}{第}{章}
\crefformatJP{section}{第}{節}
\crefformatJP{subsection}{第}{項}
\crefformatJP{appendix}{付録}{}

\renewcommand{\thesection}{\arabic{chapter}.\,\arabic{section}}
\renewcommand{\thesubsection}{\arabic{chapter}.\,\arabic{section}.\,\arabic{subsection}}

\newcommand{\crefpairconjunction}{ならびに}
\newcommand{\crefrangeconjunction}{から}
\newcommand{\crefmiddleconjunction}{、}
\newcommand{\creflastconjunction}{、ならびに}

\theoremstyle{definition}
\newtheorem{theorem}{定理}
\crefformatJP{theorem}{定理}{}
\newtheorem{lemma}{補題}
\crefformatJP{lemma}{補題}{}
\newtheorem*{proof*}{証明}
\crefformatJP{proof*}{証明}{}
\newtheorem{definition}{定義}
\crefformatJP{definition}{定義}{}
\newtheorem{proposition}{命題}
\crefformatJP{proposition}{命題}{}

% ***** 付録中の表示を設定 *****
\AtBeginEnvironment{appendices}{
  \pagestyle{plain}%
  \renewcommand{\thesection}{\Alph{chapter}.\,\arabic{section}}
  \renewcommand{\thesubsection}{\Alph{chapter}.\,\arabic{section}.\,\arabic{subsubsection}}
  \appendix%
}

% ***** 強調表示用のマクロ *****
\newcommand{\BOLD}[1]{{\bfseries\sffamily #1}}
\newcommand{\RED}[1]{\textcolor[rgb]{0.85, 0.10, 0.10}{#1}}

% ***** argmin, argmax *****
\DeclareMathOperator*{\argmax}{argmax}
\DeclareMathOperator*{\argmin}{argmin}

% ***** アルゴリズムの設定 *****
% RequireとEnsureをInputとOutputにする
\renewcommand{\algorithmicrequire}{\textbf{Input:}}
\renewcommand{\algorithmicensure}{\textbf{Output:}}

% ***** 画像を入れるフォルダの設定 *****
\graphicspath{{figs}}

% ***** タイトルページ *****
\thesistype{令和三年度 卒業論文}
\title{とってもとってもとってもとっても\\とってもとってもとってもとっても\\良い卒業論文の書き方}
\etitle{How to write a super super super\\super super super super super\\great bachelor dissertation}
\adjustspace{100truept} %%英文タイトルと指導教員名の間の垂直余白長さの調整。小さい値であるほど余白が狭くなる。タイトルが複数行にわたる場合、値を小さくして調整  
\affiliation{東京大学工学部精密工学科}
\supervisor{鈴木~宏正~教授}
\studentid{99-999999}
\author{泥濘~三角}

% ------------------------------------------------------------------------------
% 実際の文章の開始
% ------------------------------------------------------------------------------
\begin{document}

% ***** 表紙を出力 *****
\frontmatter
\maketitle

% ***** 論文全体の概要 *****
\begin{abstract}
  論文全体の概要を書く。概要は、論文全体の内容がイメージできるものである必要があるので、提案法についてだけでなく、研究背景や、提案法に至る着想、提案法の中身、実験結果、展望も含め全体について簡潔に書くことを心がける。その際、多くのことを主張することは避けて、論文の最も重要な部分、例えば、研究上の新規性であったり、提案法により得られた有効な結果について重点的に述べる。時折、やたら研究背景が長く書いてある概要を見かけるが、最低でも自分が研究したことが半分以上は概要に入るようにする。
\end{abstract}

% ***** 目次たち *****
\tableofcontents  % 目次
\clearpage

\listoffigures    % 図目次
\clearpage

\listoftables     % 表目次
\clearpage

% ------------------------------------------------------------------------------
% 本文の開始
% ------------------------------------------------------------------------------
\mainmatter

% 章ごとにファイルを分割すると良い
% ルートのディレクトリが散らからないようにサブフォルダに入れよう
\input{chapters/intro}
\input{chapters/changelog}
\input{chapters/relwork}
\input{chapters/method}
\input{chapters/results}
\input{chapters/conclusion}
\input{chapters/acknowledge}

% ------------------------------------------------------------------------------
% 参考文献
% ------------------------------------------------------------------------------

% 今回のフォーマットはBibLaTeXを使っているが、普通にBibTeXを使う場合は
% コメントされている部分を変更する

% ***** BibTeX用 *****
% \bibliographystyle{plain}
% \bibliography{pethesis}

% ***** BibLaTeX用 *****
\printbibliography[title=参考文献, heading=bibintoc]

% ------------------------------------------------------------------------------
% 付録
% ------------------------------------------------------------------------------

% 特になければ以下はコメントアウト
\begin{appendices}
  \input{chapters/appendix}
  \input{chapters/selfcheck}
\end{appendices}

% ------------------------------------------------------------------------------
% 論文の最後 (絶対消さない)
\end{document}
